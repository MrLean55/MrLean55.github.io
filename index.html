<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="root"></div>
    <script src="prop-types.js"></script>
    <script src="react.development.js"></script>
    <script src="react-dom.development.js"></script>
    <script src="prop-types.js"></script>
    <script src="babel.min.js"></script>
    <script type="text/babel">

        class App extends React.Component{

            state={
                Todos:[
                    {id:"001",time:"8:00",Mission:"Add ur plan(unfinished)",done:false},
                    {id:"002",time:"10:00",Mission:"Master ur daily plan(finished)",done:true}
                ],
                blur:false
            }

            changeDone = (id,d)=>{
                const {Todos} = this.state
                let new_todos = Todos.map((todoObj)=>{
                    if(todoObj.id == id)
                    {
                        return {...todoObj,done:!d}
                    }
                    else{
                        return todoObj
                    }
                })
                this.setState({
                    Todos:new_todos
                })
            }

            handleBlur = ()=>{
                const {blur} = this.state
                this.setState({
                    blur:!blur
                })
            }

            getTodos = (todos)=>{
                const {Todos} = this.state
                const new_Todos = [...Todos,todos]
                this.setState({
                    Todos:new_Todos
                })
            }

            cancelBlur = ()=>{
                this.setState({
                    blur:false
                })
            }

            Delete = (id)=>{
                const {Todos} = this.state
                const new_todos = Todos.filter((todoObj)=>{
                    return todoObj.id !== id
                })
                this.setState({
                    Todos:new_todos
                })
            }

            DeleteAll = ()=>{
                const {Todos} = this.state
                const new_todos = Todos.filter((todoObj)=>{
                    return todoObj.done !== true
                })
                this.setState({
                    Todos:new_todos
                })
            }

            render(){
                return(
                    <div className="App">
                        <Header/>
                        <List Delete={this.Delete} changeDone={this.changeDone} Todos={this.state.Todos} cancelBlur={this.cancelBlur} blur={this.state.blur}/>
                        <Footer DeleteAll={this.DeleteAll} getTodos={this.getTodos} blur={this.state.blur} handleBlur={this.handleBlur}/>
                    </div>
                )
            }
        }
        class Header extends React.Component{
            render(){
                return(
                    <div className="header">
                        <h1>PLAN</h1>
                    </div>
                )
            }
        }
        class List extends React.Component{

            handleClick = ()=>{
                this.props.cancelBlur()
            }

            
            render(){
                const {Todos,blur} = this.props
                const {time} = this.props.Todos
                return(
                    <div style={{filter:this.props.blur?'blur(4px)':'blur(0px)'}} className="List">
                        <ul onClick={this.handleClick}>
                            {
                                Todos.map((TodoObj)=>{
                                    return <Item Delete={this.props.Delete} changeDone={this.props.changeDone} key={TodoObj.id} {...TodoObj}/>
                                })
                            }
                        </ul>
                    </div>
                )
            }

        }
        class Item extends React.Component{

            state = {
                Item_width:"350px",
                transition:"all 0.3s",
                filter: 'brightness(1)'
            }

            handleTouchStart = e => {
                this.startX = e.touches[0].pageX
            }
            handleTouchMove = e => {
                //滑动时关闭transition
                this.setState({
                    transition:"none"
                })
                this.MoveX = e.touches[0].pageX - this.startX
                if(this.MoveX<=0 && this.MoveX>=-100)
                {
                    this.setState({
                    Item_width:350+this.MoveX+"px",
                    filter:"brightness(2)" 
                    })
                }
            };

            handleTouchEnd = e=>{
                this.setState({
                    transition:"all 0.3s"
                })
                if(parseInt(this.state.Item_width)>=280)
                {
                    //回弹
                    this.setState({
                    Item_width:"350px",
                    filter:"brightness(1)" ,
                })
                }
                else{
                    //滑到位
                    this.setState({
                    Item_width:"250px",
                    filter:"brightness(3)" ,
                    })
                }
            }

                handleClick = ()=>{
                    this.setState({
                    Item_width:"350px",
                    filter:"brightness(1)" 
                    })  

                }   
            
                handleChangeDone=(id,d)=>{
                    return ()=>{
                        this.props.changeDone(id,d)
                    }
                }

                handleDelete= (id)=>{
                    return ()=>{
                        this.props.Delete(id)
                    }
                }



            render(){
                const {id,time,Mission,done} = this.props
                return (
                    <li style={{width:this.state.Item_width,transition:this.state.transition}} onClick={this.handleClick} onTouchStart={this.handleTouchStart} onTouchMove={this.handleTouchMove} onTouchEnd={this.handleTouchEnd}>
                    <h2>{time}</h2>
                    <span><div id="dot" onTouchEnd={this.handleChangeDone(id,done)} style={{background:done?"red":"rgb(5, 207, 39)"}} ></div></span>
                    <span>{Mission}</span>
                    <div onClick={this.handleDelete(id)} id="Done"><img style={{filter:this.state.filter}} src="Del.png" alt=""/></div>
                    </li>
                )
            }
        }
        class Footer extends React.Component{


            handleClick = ()=>{
                this.props.handleBlur()
            }

            handleKeyUp =(e)=>{
                if(e.keyCode === 13)
                {
                    const time = this.refs.time1.value+":"+this.refs.time2.value
                    const todoObj = {id:Math.random(),time:time,Mission:event.target.value,done:false}
                    this.props.getTodos(todoObj)
                    this.refs.time1.value = "";
                    this.refs.time2.value = "";
                    event.target.value = "";
                    this.props.handleBlur()
                }
            }
            handleDeleteAll = ()=>{
                this.props.DeleteAll()
            }

            render(){
                return(
                    <div className="Footer">
                        <button onClick={this.handleClick} id="Add"><img src="加号1.png" alt=""/></button>
                        <form style={{display: this.props.blur?"block":"none"}} id="Add_plan" action="">
                            <input ref="time1" type="number" placeholder="00"/>
                            <input ref="time2" type="number" placeholder="00"/><span id="demo">:</span>
                            <input onKeyUp={this.handleKeyUp} type="text" placeholder="Input Ur Plan"/>
                        </form>
                        <button onClick={this.handleDeleteAll} id="Del"><img src="删除.png" alt=""/></button>
                    </div>
                )
            }
        }
        ReactDOM.render(<App/>,document.getElementById("root"))
    </script>
</body>
</html>